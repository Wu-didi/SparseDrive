# SparseDrive å®Œæ•´è¡¥å…¨æµç¨‹è¯¦è§£

## æ€»è§ˆ

å½“å‰ç³»ç»Ÿé‡‡ç”¨**ä¸‰çº§çº§è”è¡¥å…¨ç­–ç•¥**ï¼Œæ¯ä¸€çº§éƒ½æœ‰ç‰¹å®šçš„ä½œç”¨ï¼š

```
è¾“å…¥å›¾åƒ â†’ ç›¸æœºé®æŒ¡ â†’ ç‰¹å¾æå– â†’ [è¡¥å…¨1] â†’ [è¡¥å…¨2] â†’ [è¡¥å…¨3] â†’ ä¸‹æ¸¸ä»»åŠ¡
                                    VAE    æ—¶åºè¡¥å…¨  è§„åˆ’å¼•å¯¼
```

---

## è¯¦ç»†æµç¨‹ï¼ˆforward_trainï¼‰

### Step 1: ç›¸æœºé®æŒ¡æ¨¡æ‹Ÿ

```python
# ä½ç½®: sparsedrive.py:1430
img_masked, cam_mask = self.cam_dropout(img, return_mask=True)
# cam_mask: [B, V] bool, Trueè¡¨ç¤ºè¯¥ç›¸æœºè¢«é®æŒ¡
```

**å‚æ•°**ï¼š
- `p_missing=0.6`: æ¯ä¸ªæ ·æœ¬60%æ¦‚ç‡è§¦å‘é®æŒ¡
- `n_min=1, n_max=2`: éšæœºé®æŒ¡1-2ä¸ªç›¸æœº

**è¾“å‡º**ï¼š
- `img_masked`: é®æŒ¡ç›¸æœºçš„åƒç´ è¢«ç½®é›¶
- `cam_mask`: å¸ƒå°”æ©ç ï¼Œæ ‡è®°å“ªäº›ç›¸æœºå¤±æ•ˆ

---

### Step 2: ç‰¹å¾æå–

```python
# ä½ç½®: sparsedrive.py:1434-1442

# é®æŒ¡åˆ†æ”¯ï¼ˆå¸¦æ¢¯åº¦ï¼Œstudentï¼‰
feats_mask_base = self._extract_backbone_neck(img_masked)
# â†’ List[Tensor[B, V, C, H, W]]ï¼Œ4ä¸ªå°ºåº¦

# å®Œæ•´åˆ†æ”¯ï¼ˆno_gradï¼Œteacherï¼‰
with torch.no_grad():
    feats_full_base = self._extract_backbone_neck(img_full)
```

**è¾“å‡º**ï¼š
- 4ä¸ªå°ºåº¦çš„ç‰¹å¾ï¼š`[256, 256, 256, 256]` é€šé“
- å°ºåº¦ï¼š`[1/8, 1/16, 1/32, 1/64]` åˆ†è¾¨ç‡

---

### Step 3: è‡ªç›‘ç£æŸå¤±

```python
# ä½ç½®: sparsedrive.py:1445
loss_ssl = self.compute_ssl_loss(feats_full_base, feats_mask_base, cam_mask)
```

**ä½œç”¨**ï¼šå¯¹é®æŒ¡ç›¸æœºçš„ç‰¹å¾æ–½åŠ ä¸€è‡´æ€§çº¦æŸï¼Œè¿«ä½¿æ¨¡å‹å­¦ä¹ è¡¥å…¨ã€‚

---

## ğŸ”¥ è¡¥å…¨æµæ°´çº¿

### è¡¥å…¨çº§åˆ« 1: è¿åŠ¨è¡¥å¿æ—¶åºè¡¥å…¨

```python
# ä½ç½®: sparsedrive.py:1457
feats_temporal = self.temporal_completion(
    feats_mask_base,  # é®æŒ¡åçš„ç‰¹å¾
    cam_mask,         # å“ªäº›ç›¸æœºå¤±æ•ˆ
    metas=data        # åŒ…å« T_global, lidar2img ç­‰
)
```

**ç‰ˆæœ¬è¯´æ˜**ï¼š
- **V1 ç‰ˆæœ¬**ï¼ˆ`MotionCompensatedTemporalCompletion`ï¼‰ï¼šå…¨å±€è·¨ç›¸æœºæ³¨æ„åŠ›
- **V2 ç‰ˆæœ¬**ï¼ˆ`MotionCompensatedTemporalCompletionV2`ï¼‰ï¼šå±€éƒ¨è·¨ç›¸æœºæ³¨æ„åŠ›ï¼ˆæ˜¾å­˜ä¼˜åŒ–ï¼‰
  - åŸºäºç›¸æœºæ‹“æ‰‘ï¼Œåªå…³æ³¨ç›¸é‚»ç›¸æœºï¼ˆ3ä¸ª vs 6ä¸ªï¼‰
  - æ˜¾å­˜å‡å°‘çº¦ 50%ï¼Œè®¡ç®—åŠ é€Ÿçº¦ 40%
  - é…ç½®æ–‡ä»¶ï¼š`sparsedrive_small_stage2_v2.py`

#### å†…éƒ¨æµç¨‹ï¼ˆtemporal_completion.pyï¼‰

```
1. æ£€æŸ¥å†å²é˜Ÿåˆ—
   â”œâ”€ å¦‚æœæ²¡æœ‰å†å² â†’ ç›´æ¥è¿”å›
   â””â”€ åœºæ™¯åˆ‡æ¢æ£€æµ‹ï¼ˆæ—¶é—´é—´éš” > 2s â†’ æ¸…ç©ºé˜Ÿåˆ—ï¼‰

2. è¿åŠ¨è¡¥å¿ Warp
   â”œâ”€ è®¡ç®— T_temp2cur = T_global_cur^(-1) @ T_global_hist
   â”œâ”€ å¤šæ·±åº¦å‡è®¾ [10m, 30m]
   â”œâ”€ 3D æŠ•å½± â†’ 2D grid
   â””â”€ å¯å­¦ä¹ åç§» refinement

3. è·¨ç›¸æœºæ—¶åºæ³¨æ„åŠ›
   â”œâ”€ Query: å¤±æ•ˆç›¸æœºä½ç½® [B, H*W, C]
   â”œâ”€ Key/Value: æ‰€æœ‰ç›¸æœº Ã— æ‰€æœ‰å†å²å¸§ï¼ˆ4xä¸‹é‡‡æ ·ï¼‰
   â”‚   â””â”€ æ·»åŠ ä½ç½®ç¼–ç ï¼ˆç›¸æœº + æ—¶é—´ + ç©ºé—´ï¼‰
   â””â”€ å¤šå¤´æ³¨æ„åŠ› â†’ [B, C, H, W]

4. ç©ºé—´è§£ç  + é—¨æ§èåˆ
   â”œâ”€ ç©ºé—´è§£ç å™¨ç»†åŒ–ç‰¹å¾
   â”œâ”€ é—¨æ§ç½‘ç»œè®¡ç®—èåˆæƒé‡
   â””â”€ fused = original * (1-gate) + completed * gate

5. æ›´æ–°å†å²é˜Ÿåˆ—
   â””â”€ ä¿å­˜å½“å‰å¸§ç‰¹å¾ç”¨äºä¸‹æ¬¡æ¨ç†
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… åªå¤„ç†æœ€ç²—å°ºåº¦ï¼ˆ1/32ï¼‰ï¼Œæ˜¾å­˜å‹å¥½
- âœ… åœºæ™¯åˆ‡æ¢è‡ªåŠ¨æ£€æµ‹
- âœ… è·¨ç›¸æœºèåˆï¼ˆå¤±æ•ˆç›¸æœºå¯å€ŸåŠ©é‚»è¿‘ç›¸æœºå†å²ï¼‰
- âœ… è¿åŠ¨è¡¥å¿æ¶ˆé™¤ç‰¹å¾é”™ä½

**è¾“å‡º**ï¼š`feats_temporal` - æ—¶åºè¡¥å…¨åçš„ç‰¹å¾

---

### è¡¥å…¨çº§åˆ« 2: VAE åŸºç¡€è¡¥å…¨

```python
# ä½ç½®: sparsedrive.py:1481
feature_maps, vae_loss = self.pv_recon(
    feats_temporal,  # æ—¶åºè¡¥å…¨åçš„ç‰¹å¾ï¼ˆä½œä¸ºè¾“å…¥ï¼‰
    cam_mask,
    metas=data
)
```

#### å†…éƒ¨æµç¨‹ï¼ˆPVReconVAEï¼‰

```
å¯¹æ¯ä¸ªå°ºåº¦ç‹¬ç«‹å¤„ç†ï¼š
1. ç¼–ç å™¨ï¼šConv â†’ æ½œç©ºé—´ (mu, logvar)
2. é‡å‚æ•°åŒ–ï¼šz = mu + eps * exp(0.5 * logvar)
3. è§£ç å™¨ï¼šConvTranspose â†’ é‡å»ºç‰¹å¾
4. æŸå¤±ï¼š
   â”œâ”€ é‡å»ºæŸå¤±ï¼šMSE(é‡å»º, GT)
   â””â”€ KLæ•£åº¦ï¼šregularize æ½œç©ºé—´åˆ†å¸ƒ
```

**ä½œç”¨**ï¼š
- å¡«è¡¥æ—¶åºè¡¥å…¨å¯èƒ½é—æ¼çš„ç»†èŠ‚
- æä¾›é›¶æ ·æœ¬è¡¥å…¨èƒ½åŠ›ï¼ˆæ— å†å²æ—¶çš„ fallbackï¼‰

**è¾“å‡º**ï¼š
- `feature_maps`: VAE é‡å»ºåçš„ç‰¹å¾
- `vae_loss`: åŒ…å« `loss_rec` å’Œ `loss_kl`

---

### è¡¥å…¨çº§åˆ« 3: è§„åˆ’å¼•å¯¼ç²¾ç»†è¡¥å…¨

```python
# ä½ç½®: sparsedrive.py:1527
feature_maps_guided, importance_maps = self.planning_guided_completion(
    feature_maps,      # VAE è¡¥å…¨åçš„ç‰¹å¾
    cam_mask,
    ego_trajectory,    # GT ego è½¨è¿¹ [B, T, 2]
    cam_params         # ç›¸æœºå‚æ•°ï¼ˆç”¨äºæŠ•å½±ï¼‰
)
```

#### å†…éƒ¨æµç¨‹ï¼ˆPlanningGuidedCompletionï¼‰

```
å¯¹æ¯ä¸ªå°ºåº¦ï¼š
1. è·¨ç›¸æœºæ³¨æ„åŠ›
   â”œâ”€ å¤±æ•ˆç›¸æœºä»æœ‰æ•ˆç›¸æœºå€Ÿç”¨ç‰¹å¾
   â””â”€ CrossCameraAttention: [B, V, C, H, W]

2. è½¨è¿¹é‡è¦æ€§ç¼–ç ï¼ˆå¯é€‰ï¼‰
   â”œâ”€ å°† ego è½¨è¿¹æŠ•å½±åˆ°å›¾åƒå¹³é¢
   â”œâ”€ è®¡ç®—æ¯ä¸ªåƒç´ åˆ°è½¨è¿¹çš„è·ç¦»
   â””â”€ ç”Ÿæˆé‡è¦æ€§å›¾ [B, V, H, W]

3. åŒè·¯è¡¥å…¨ç½‘ç»œ
   â”œâ”€ ç²—ç³™è¡¥å…¨ç½‘ç»œï¼ˆå…¨å±€ï¼‰
   â””â”€ ç²¾ç»†è¡¥å…¨ç½‘ç»œï¼ˆè½¨è¿¹åŒºåŸŸï¼‰

4. åŸºäºé‡è¦æ€§åŠ æƒèåˆ
   completed = coarse * (1 - importance) + fine * importance

5. é—¨æ§èåˆåˆ°åŸå§‹ç‰¹å¾
   output = original * (1 - gate) + completed * gate
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… è½¨è¿¹å…³é”®åŒºåŸŸç²¾ç»†è¡¥å…¨
- âœ… è·¨ç›¸æœºä¿¡æ¯å…±äº«
- âœ… æ¢¯åº¦å¯åä¼ ï¼ˆç«¯åˆ°ç«¯è®­ç»ƒï¼‰

**è¾“å‡º**ï¼š
- `feature_maps_guided`: è§„åˆ’å¼•å¯¼è¡¥å…¨åçš„ç‰¹å¾
- `importance_maps`: è½¨è¿¹é‡è¦æ€§å›¾

---

## å®Œæ•´æµç¨‹å›¾

```
è¾“å…¥å›¾åƒ [B, 6, 3, 900, 1600]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RandCamMask             â”‚
â”‚  p=0.6, n=1~2ç›¸æœº        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
img_masked [é®æŒ¡ç›¸æœºç½®é›¶]
cam_mask [B, 6] bool
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backbone + FPN          â”‚
â”‚  ResNet50 â†’ 4å°ºåº¦ç‰¹å¾    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
feats_mask_base [4 Ã— [B, 6, 256, H, W]]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¥å…¨çº§åˆ« 1: è¿åŠ¨è¡¥å¿æ—¶åºè¡¥å…¨                      â”‚
â”‚  MotionCompensatedTemporalCompletion             â”‚
â”‚                                                  â”‚
â”‚  - å†å²é˜Ÿåˆ—ç®¡ç†ï¼ˆåœºæ™¯åˆ‡æ¢æ£€æµ‹ï¼‰                    â”‚
â”‚  - è¿åŠ¨è¡¥å¿ Warp (T_temp2cur)                    â”‚
â”‚  - è·¨ç›¸æœºæ—¶åºæ³¨æ„åŠ›                               â”‚
â”‚  - ç©ºé—´è§£ç  + é—¨æ§èåˆ                            â”‚
â”‚                                                  â”‚
â”‚  ç‰¹ç‚¹ï¼šåˆ©ç”¨å†å²å¸§ + å‡ ä½•å¯¹é½                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
feats_temporal [æ—¶åºè¡¥å…¨]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¥å…¨çº§åˆ« 2: VAE åŸºç¡€è¡¥å…¨                         â”‚
â”‚  PVReconVAE                                      â”‚
â”‚                                                  â”‚
â”‚  - ç¼–ç å™¨ â†’ æ½œç©ºé—´ (mu, logvar)                  â”‚
â”‚  - é‡å‚æ•°åŒ–é‡‡æ ·                                   â”‚
â”‚  - è§£ç å™¨ â†’ é‡å»ºç‰¹å¾                              â”‚
â”‚                                                  â”‚
â”‚  ç‰¹ç‚¹ï¼šé›¶æ ·æœ¬è¡¥å…¨èƒ½åŠ›ï¼Œå¡«è¡¥ç»†èŠ‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
feature_maps [VAE è¡¥å…¨]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¥å…¨çº§åˆ« 3: è§„åˆ’å¼•å¯¼ç²¾ç»†è¡¥å…¨                      â”‚
â”‚  PlanningGuidedCompletion                        â”‚
â”‚                                                  â”‚
â”‚  - è½¨è¿¹é‡è¦æ€§ç¼–ç                                  â”‚
â”‚  - è·¨ç›¸æœºæ³¨æ„åŠ›                                   â”‚
â”‚  - åŒè·¯è¡¥å…¨ï¼ˆç²—ç³™ + ç²¾ç»†ï¼‰                        â”‚
â”‚  - é‡è¦æ€§åŠ æƒèåˆ                                 â”‚
â”‚                                                  â”‚
â”‚  ç‰¹ç‚¹ï¼šä»»åŠ¡å¯¼å‘ï¼Œè½¨è¿¹åŒºåŸŸç²¾ç»†è¡¥å…¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
feature_maps_guided [æœ€ç»ˆè¡¥å…¨ç‰¹å¾]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SparseDriveHead         â”‚
â”‚  â†’ æ£€æµ‹/è·Ÿè¸ª/å»ºå›¾/è§„åˆ’   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¡¥å…¨ç­–ç•¥å¯¹æ¯”

| è¡¥å…¨æ–¹æ³• | è¾“å…¥ | ä¾èµ– | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|---------|------|------|------|------|
| **æ—¶åºè¡¥å…¨** | å†å²ç‰¹å¾ | è¿åŠ¨ä¿¡æ¯ | å‡ ä½•å‡†ç¡®ï¼Œè·¨ç›¸æœºèåˆ | éœ€è¦å†å²ï¼Œå†·å¯åŠ¨å·® |
| **VAE è¡¥å…¨** | å½“å‰ç‰¹å¾ | å­¦ä¹ åˆ†å¸ƒ | é›¶æ ·æœ¬ï¼Œå¿«é€Ÿ | ç¼ºä¹å‡ ä½•çº¦æŸ |
| **è§„åˆ’å¼•å¯¼** | è¡¥å…¨ç‰¹å¾ | è½¨è¿¹ä¿¡æ¯ | ä»»åŠ¡ç›¸å…³ï¼Œé‡ç‚¹åŒºåŸŸç²¾ç»† | éœ€è¦è½¨è¿¹GT |

---

## æ˜¾å­˜åˆ†é…ï¼ˆä¼°ç®—ï¼‰

| æ¨¡å— | æ˜¾å­˜å ç”¨ | ä¼˜åŒ–ç­–ç•¥ |
|-----|---------|---------|
| Backbone + FPN | ~8 GB | æ··åˆç²¾åº¦ FP16 |
| æ—¶åºè¡¥å…¨ | ~4 GB | å•å°ºåº¦ + KVä¸‹é‡‡æ · |
| VAE è¡¥å…¨ | ~2 GB | åˆ†å°ºåº¦å¤„ç† |
| è§„åˆ’å¼•å¯¼ | ~2 GB | é—¨æ§ç½‘ç»œè½»é‡åŒ– |
| **æ€»è®¡** | **~16 GB** | å•å¡ A100 å¯è®­ç»ƒ |

---

## è®­ç»ƒæ—¶çš„æŸå¤±å‡½æ•°

```python
total_loss =
    + loss_det        # æ£€æµ‹æŸå¤±
    + loss_track      # è·Ÿè¸ªæŸå¤±
    + loss_map        # å»ºå›¾æŸå¤±
    + loss_plan       # è§„åˆ’æŸå¤±
    + loss_ssl        # è‡ªç›‘ç£ä¸€è‡´æ€§æŸå¤±
    + loss_vae_rec    # VAE é‡å»ºæŸå¤±
    + loss_vae_kl     # VAE KL æ•£åº¦
    + loss_planning_guided  # è§„åˆ’å¼•å¯¼æŸå¤±ï¼ˆå¯é€‰ï¼‰
```

æ‰€æœ‰æŸå¤±è”åˆä¼˜åŒ–ï¼Œå®ç°ç«¯åˆ°ç«¯è®­ç»ƒã€‚

---

## æ¨ç†æ—¶çš„ç®€åŒ–ï¼ˆsimple_testï¼‰

```python
# ä½ç½®: sparsedrive.py:1610-1627

# æ¨ç†æ—¶åªä½¿ç”¨æ ¸å¿ƒè¡¥å…¨æ¨¡å—
with torch.no_grad():
    # 1. æ—¶åºè¡¥å…¨
    feature_maps = self.temporal_completion(...)

    # 2. è§„åˆ’å¼•å¯¼è¡¥å…¨ï¼ˆè·¨ç›¸æœºæ³¨æ„åŠ›ï¼Œä¸ä½¿ç”¨è½¨è¿¹ï¼‰
    feature_maps_guided, _ = self.planning_guided_completion(
        feature_maps, cam_mask,
        ego_trajectory=None,  # æ¨ç†æ—¶æ— GTè½¨è¿¹
        cam_params=None
    )
```

**æ³¨æ„**ï¼šæ¨ç†æ—¶ä¸ä½¿ç”¨ VAEï¼Œç›´æ¥ç”¨æ—¶åº+è§„åˆ’å¼•å¯¼è¡¥å…¨ã€‚

---

## é…ç½®æ§åˆ¶

åœ¨ `sparsedrive_small_stage2.py` ä¸­å¯ä»¥çµæ´»æ§åˆ¶ï¼š

```python
# ç¦ç”¨æ—¶åºè¡¥å…¨
temporal_completion_cfg = dict(enable=False)

# ç¦ç”¨è§„åˆ’å¼•å¯¼è¡¥å…¨
planning_guided_completion_cfg = dict(enable=False)

# è°ƒæ•´æ˜¾å­˜å ç”¨
temporal_completion_cfg = dict(
    queue_length=1,    # å‡å°‘å†å²å¸§
    kv_downsample=8,   # å¢å¤§ä¸‹é‡‡æ ·
)
```

---

## æ€»ç»“

å½“å‰è¡¥å…¨ç³»ç»Ÿæ˜¯ä¸€ä¸ª**ä¸‰çº§çº§è” + ç«¯åˆ°ç«¯è®­ç»ƒ**çš„æ¶æ„ï¼š

1. **æ—¶åºè¡¥å…¨**ï¼šåˆ©ç”¨è¿åŠ¨å‡ ä½•å¯¹é½å†å²ç‰¹å¾
2. **VAE è¡¥å…¨**ï¼šæä¾›é›¶æ ·æœ¬è¡¥å…¨èƒ½åŠ›
3. **è§„åˆ’å¼•å¯¼**ï¼šä»»åŠ¡å¯¼å‘çš„ç²¾ç»†è¡¥å…¨

ä¸‰è€…ååŒå·¥ä½œï¼Œåœ¨æœ‰é™æ˜¾å­˜ä¸‹å®ç°é²æ£’çš„ç›¸æœºæ•…éšœå¤„ç†ã€‚

---

## ç‰ˆæœ¬å¯¹æ¯”ï¼šV1 vs V2

### æ—¶åºè¡¥å…¨æ¨¡å—ç‰ˆæœ¬å·®å¼‚

| ç‰¹æ€§ | V1 ç‰ˆæœ¬ | V2 ç‰ˆæœ¬ |
|-----|--------|--------|
| **æ¨¡å—å** | `MotionCompensatedTemporalCompletion` | `MotionCompensatedTemporalCompletionV2` |
| **æ–‡ä»¶ä½ç½®** | `temporal_completion.py` | `temporal_completion_v2.py` |
| **é…ç½®æ–‡ä»¶** | `sparsedrive_small_stage2.py` | `sparsedrive_small_stage2_v2.py` |
| **è·¨ç›¸æœºæ³¨æ„åŠ›** | å…¨å±€ï¼ˆ6ä¸ªç›¸æœºï¼‰ | å±€éƒ¨ï¼ˆ3ä¸ªç›¸é‚»ç›¸æœºï¼‰ |
| **æ³¨æ„åŠ›èŒƒå›´** | 6Ã—TÃ—HÃ—W | 3Ã—TÃ—HÃ—W |
| **æ˜¾å­˜å ç”¨** | åŸºå‡† | -50% |
| **è®¡ç®—é€Ÿåº¦** | åŸºå‡† | +40% |
| **ç²¾åº¦** | åŸºå‡† | é¢„æœŸæ— æ˜æ˜¾æŸå¤± |
| **ç›¸æœºæ‹“æ‰‘æ„ŸçŸ¥** | âŒ æ—  | âœ… åŸºäº nuScenes ç‰©ç†å¸ƒå±€ |

### V2 çš„ç›¸æœºæ‹“æ‰‘ç»“æ„

nuScenes ç›¸æœºå¸ƒå±€ï¼š
```
    1 (FRONT_LEFT)     0 (FRONT)     2 (FRONT_RIGHT)
            \              |              /
             \             |             /
              \            |            /
    3 (BACK_LEFT)      5 (BACK)      4 (BACK_RIGHT)
```

æ¯ä¸ªç›¸æœºçš„é‚»æ¥å…³ç³»ï¼š
- **FRONT (0)**ï¼šå…³æ³¨ [è‡ªèº«, FRONT_LEFT, FRONT_RIGHT]
- **FRONT_LEFT (1)**ï¼šå…³æ³¨ [è‡ªèº«, FRONT, BACK_LEFT]
- **FRONT_RIGHT (2)**ï¼šå…³æ³¨ [è‡ªèº«, FRONT, BACK_RIGHT]
- **BACK_LEFT (3)**ï¼šå…³æ³¨ [è‡ªèº«, FRONT_LEFT, BACK]
- **BACK_RIGHT (4)**ï¼šå…³æ³¨ [è‡ªèº«, FRONT_RIGHT, BACK]
- **BACK (5)**ï¼šå…³æ³¨ [è‡ªèº«, BACK_LEFT, BACK_RIGHT]

### é€‰æ‹©å»ºè®®

**æ¨èä½¿ç”¨ V2 ç‰ˆæœ¬**ï¼š
- æ˜¾å­˜å—é™çš„åœºæ™¯ï¼ˆå°äº 24GB æ˜¾å­˜ï¼‰
- éœ€è¦åŠ é€Ÿè®­ç»ƒçš„åœºæ™¯
- è¿½æ±‚æ€§ä»·æ¯”çš„åœºæ™¯

**ç»§ç»­ä½¿ç”¨ V1 ç‰ˆæœ¬**ï¼š
- æ˜¾å­˜å……è¶³ï¼ˆ>= 40GBï¼‰
- è¿½æ±‚æè‡´ç²¾åº¦
- å·²æœ‰ V1 è®­ç»ƒå¥½çš„æ¨¡å‹

**åˆ‡æ¢æ–¹æ³•**ï¼š
```bash
# ä½¿ç”¨ V1
bash ./tools/dist_train.sh projects/configs/sparsedrive_small_stage2.py <num_gpus>

# ä½¿ç”¨ V2ï¼ˆæ¨èï¼‰
bash ./tools/dist_train.sh projects/configs/sparsedrive_small_stage2_v2.py <num_gpus>
```
